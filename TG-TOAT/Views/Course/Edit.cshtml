@model TGTOAT.Models.AddCourseViewModel

@{
    ViewData["Title"] = "Edit Course";
    Layout = "~/Views/Shared/_InstructorLayout.cshtml";
}

<h1 class="text-center">Edit a Course</h1>
@* <form asp-action="Edit" method="post">
    <input type="hidden" asp-for="CourseId" /> *@
<form asp-controller="Course" asp-action="Edit" method="post">
    <input type="hidden" asp-for="CourseId" />

    <div class="container-fluid">
        <!-- Department & Course Number -->
        <div class="row justify-content-center">
            <div class="form-group col-md-3">
                <label asp-for="SelectedDepartmentId" class="control-label"></label>
                <select asp-for="SelectedDepartmentId" class="form-control" 
                        asp-items="@(new SelectList(Model.Departments, "DepartmentId", "DepartmentName", Model.SelectedDepartmentId))">
                    <option value="">Select Department</option>
                </select>
                <span asp-validation-for="SelectedDepartmentId" class="text-danger"></span>
            </div>

            <div class="form-group col-md-3">
                <label asp-for="CourseNumber">Course Number</label>
                <input asp-for="CourseNumber" class="form-control" />
                <span asp-validation-for="CourseNumber" class="text-danger"></span>
            </div>

            <div class="form-group col-md-3">
                <label asp-for="NumberOfCredits">Number of Credits</label>
                <input asp-for="NumberOfCredits" class="form-control" type="number" min="0" />
                <span asp-validation-for="NumberOfCredits" class="text-danger"></span>
            </div>

        </div>

        <div class="row justify-content-center">
            <div class="form-group col-md-6">
                <label asp-for="CourseName">Course Name</label>
                <input asp-for="CourseName" class="form-control" />
                <span asp-validation-for="CourseName" class="text-danger"></span>
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="form-group col-md-6">
                <label asp-for="CourseDescription">Course Description</label>
                <textarea asp-for="CourseDescription" class="form-control"></textarea>
                <span asp-validation-for="CourseDescription" class="text-danger"></span>
            </div>
        </div>

        <!-- Days of the Week -->
        <div class="form-group row justify-content-center">
            <label asp-for="DaysOfTheWeek" class="DaysLabel"></label>
            <div class="btn-group-toggle row justify-content-center" data-toggle="buttons">
                <!-- Prepopulate the checkbox values based on the existing `DaysOfTheWeek` -->
                <div class="col-md-5">
                    <input type="checkbox" class="btn-check" id="monBtn" value="Mo" @(Model.DaysOfTheWeek.Contains("Mo") ? "checked" : "") autocomplete="off">
                    <label class="btn btn-outline-primary" for="monBtn">Monday</label>

                    <input type="checkbox" class="btn-check" id="tueBtn" value="Tu" @(Model.DaysOfTheWeek.Contains("Tu") ? "checked" : "") autocomplete="off">
                    <label class="btn btn-outline-primary" for="tueBtn">Tuesday</label>

                    <input type="checkbox" class="btn-check" id="wedBtn" value="We" @(Model.DaysOfTheWeek.Contains("We") ? "checked" : "") autocomplete="off">
                    <label class="btn btn-outline-primary" for="wedBtn">Wednesday</label>

                    <input type="checkbox" class="btn-check" id="thuBtn" value="Th" @(Model.DaysOfTheWeek.Contains("Th") ? "checked" : "") autocomplete="off">
                    <label class="btn btn-outline-primary" for="thuBtn">Thursday</label>

                    <input type="checkbox" class="btn-check" id="friBtn" value="Fr" @(Model.DaysOfTheWeek.Contains("Fr") ? "checked" : "") autocomplete="off">
                    <label class="btn btn-outline-primary" for="friBtn">Friday</label>                    
                </div>
            </div>
            <input asp-for="DaysOfTheWeek" type="hidden" id="DaysOfTheWeek" />
            <span asp-validation-for="DaysOfTheWeek" class="text-danger"></span>
        </div>


        <!-- Location Information -->
        <div class="row justify-content-center">
            <div class="form-group col-md-3">
                <label asp-for="Campus"></label>
                <select asp-for="Campus" id="Campus" asp-items="Model.CampusList" class="form-select">
                    <option value="">Select a Campus</option>
                </select>
                <span asp-validation-for="Campus" class="text-danger"></span>
            </div>

            <div class="form-group col-md-3">
                <label asp-for="Building"></label>                
                <select asp-for="Building" id="Building" asp-items="Model.Buildings" class="form-select">
                    <option value="">Select a Building</option>
                </select>
                <span asp-validation-for="Building" class="text-danger"></span>
            </div>

            <div class="form-group col-md-3">
                <label asp-for="RoomNumber">Room Number</label>
                <input asp-for="RoomNumber" class="form-control" />
                <span asp-validation-for="RoomNumber" class="text-danger"></span>
            </div>
        </div>

        <!-- Class Time -->
        <div class="row justify-content-center">
            <div class="form-group col-md-3">
                <label asp-for="StartTime">Start Time</label>
                <input asp-for="StartTime" type="time" class="form-control" />
                <span asp-validation-for="StartTime" class="text-danger"></span>
            </div>

            <div class="form-group col-md-3">
                <label asp-for="EndTime">End Time</label>
                <input asp-for="EndTime" type="time" class="form-control" />
                <span asp-validation-for="EndTime" class="text-danger"></span>
            </div>

            <div class="form-group col-md-3">
                <label asp-for="Capacity">Capacity</label>
                <input asp-for="Capacity" class="form-control" type="number" min="0" max="999"/>
                <span asp-validation-for="Capacity" class="text-danger"></span>
            </div>
        </div>

        <!-- Semester and Year -->
        <div class="row justify-content-center">
            <div class="form-group col-md-3">
                <label asp-for="Semester"></label>
                <select asp-for="Semester" asp-items="Model.SemesterList" class="form-select">
                    <option value="">Select a Semester</option>
                </select>
                <span asp-validation-for="Semester" class="text-danger"></span>
            </div>

            <div class="form-group col-md-3">
                <label asp-for="Year"></label>
                <input asp-for="Year" class="form-control" type="number" min="@Model.CurrYear" />
                <span asp-validation-for="Year" class="text-danger"></span>
            </div>
        </div>

        <!-- Instructor -->
        <div class="row justify-content-center">
            <div class="form-group col-md-6">
                <label asp-for="SelectedInstructorId"></label>
                <select asp-for="SelectedInstructorId" asp-items="@(new SelectList(Model.Instructors, "Id", "FullName", Model.SelectedInstructorId))" class="form-select">
                    <option value="">Select an instructor</option>
                </select>
                <span asp-validation-for="SelectedInstructorId" class="text-danger"></span>
            </div>
        </div>

        <br />
        <div class="col text-center">
            <button type="submit" class="btn btn-primary text-center">Save</button>
            <a href="@Url.Action("Courses", "Course")" class="btn btn-secondary">Cancel</a>
        </div>

    </div>
</form>

<script src="~/js/courses.js" asp-append-version="true"></script>

@section Scripts {
    <script>
        function updateDaysOfTheWeek() {
            let selectedDays = [];
            if (document.getElementById("monBtn").checked) selectedDays.push("Mo");
            if (document.getElementById("tueBtn").checked) selectedDays.push("Tu");
            if (document.getElementById("wedBtn").checked) selectedDays.push("We");
            if (document.getElementById("thuBtn").checked) selectedDays.push("Th");
            if (document.getElementById("friBtn").checked) selectedDays.push("Fr");
            
            document.getElementById("DaysOfTheWeek").value = selectedDays.join(',');
            return true; // Allow form submission
        }

        // Remove the onclick="UpdateDays()" from your save button and update it to:
        document.querySelector("form").addEventListener("submit", function(e) {
            e.preventDefault(); // Prevent immediate form submission
            console.log("Form submission intercepted");
            
            // Update days of the week
            updateDaysOfTheWeek();
            console.log("Days updated:", document.getElementById("DaysOfTheWeek").value);
            
            // Submit the form
            console.log("Submitting form");
            this.submit();
        });
    </script>

    <script>
        $(document).ready(function () {
            $('#Campus').change(function () {
                var selectedCampus = $(this).val(); // Get the selected campus value
                var buildingSelect = $('#Building'); // Get the building dropdown

                // Make AJAX call to GetBuildingsByCampus to get the buildings for the selected campus
                $.ajax({
                    url: '@Url.Action("GetBuildingsByCampus", "Course")', // Call the controller action
                    type: 'GET',
                    dataType: 'json',
                    data: { campus: selectedCampus },  // Pass the selected campus as a parameter
                    success: function (data) {
                        buildingSelect.empty();  // Clear the building dropdown
                        buildingSelect.append('<option value="">Select a Building</option>');  // Add default option

                        // Populate the building dropdown with the returned buildings
                        $.each(data, function (i, building) {
                            buildingSelect.append('<option value="' + building.value + '">' + building.text + '</option>');
                        });
                    },
                    error: function (xhr, status, error) {
                        console.error("An error occurred while fetching buildings: " + error);
                    }
                });
            });
        });
    </script>

    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
